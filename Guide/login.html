<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login</title>
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      background: radial-gradient(1200px 600px at 30% 20%, #1b2a6b 0%, rgba(27,42,107,0) 60%),
                  radial-gradient(900px 500px at 70% 70%, #6b1b4d 0%, rgba(107,27,77,0) 55%),
                  #070914;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial;
      color: rgba(255,255,255,.92);
    }
    .card{
      width:min(420px, calc(100vw - 32px));
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 22px 20px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    h1{ margin:0 0 12px; font-size: 20px; letter-spacing:.5px; }
    .muted{ margin:0 0 18px; color: rgba(255,255,255,.65); font-size: 13px; line-height:1.5; }
    label{ display:block; font-size: 13px; color: rgba(255,255,255,.78); margin: 0 0 8px; }
    input{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      outline: none;
    }
    input:focus{ border-color: rgba(130,170,255,.55); box-shadow: 0 0 0 3px rgba(80,120,255,.18); }
    .row{ display:flex; gap:10px; margin-top: 14px; }
    button{
      flex:1;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(120,140,255,.18);
      color: rgba(255,255,255,.92);
      cursor:pointer;
    }
    button:hover{ background: rgba(120,140,255,.26); }
    .ghost{ background: rgba(255,255,255,.06); }
    .ghost:hover{ background: rgba(255,255,255,.10); }
    .err{
      margin-top: 12px;
      color: rgba(255,140,140,.95);
      font-size: 13px;
      min-height: 18px;
    }
    code{ background: rgba(255,255,255,.08); padding:2px 6px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>登入</h1>
    <p class="muted">請輸入密碼，通過後跳轉到 <code>index.html</code>。</p>

    <form id="loginForm" autocomplete="off">
      <label for="pwd">密碼</label>
      <input id="pwd" type="password" placeholder="Enter password" required />
      <div class="row">
        <button type="submit">登入</button>
        <button type="button" class="ghost" id="clearBtn">清除</button>
      </div>
      <div class="err" id="msg"></div>
    </form>
  </div>

  <script>
    /* ============================================================
       設定區（後台只看到亂碼）
       - 正確密碼：NTUB
       - 但這裡只放「亂碼 token」，使用者輸入 NTUB 會被公式運算成對應亂碼來比對
       ============================================================ */
    const SECRET_TOKEN = "AQRNmSdl0g1OVFVCfDdmM2E5YzFksMiWkA<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login</title>
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      background: radial-gradient(1200px 600px at 30% 20%, #1b2a6b 0%, rgba(27,42,107,0) 60%),
                  radial-gradient(900px 500px at 70% 70%, #6b1b4d 0%, rgba(107,27,77,0) 55%),
                  #070914;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial;
      color: rgba(255,255,255,.92);
    }
    .card{
      width:min(420px, calc(100vw - 32px));
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 22px 20px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
    }
    h1{ margin:0 0 12px; font-size: 20px; letter-spacing:.5px; }
    .muted{ margin:0 0 18px; color: rgba(255,255,255,.65); font-size: 13px; line-height:1.5; }
    label{ display:block; font-size: 13px; color: rgba(255,255,255,.78); margin: 0 0 8px; }
    input{
      width:100%;
      box-sizing:border-box;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      outline: none;
    }
    input:focus{ border-color: rgba(130,170,255,.55); box-shadow: 0 0 0 3px rgba(80,120,255,.18); }
    .row{ display:flex; gap:10px; margin-top: 14px; }
    button{
      flex:1;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(120,140,255,.18);
      color: rgba(255,255,255,.92);
      cursor:pointer;
    }
    button:hover{ background: rgba(120,140,255,.26); }
    .ghost{ background: rgba(255,255,255,.06); }
    .ghost:hover{ background: rgba(255,255,255,.10); }
    .err{
      margin-top: 12px;
      color: rgba(255,140,140,.95);
      font-size: 13px;
      min-height: 18px;
    }
    code{ background: rgba(255,255,255,.08); padding:2px 6px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>登入</h1>
    <p class="muted">請輸入密碼，通過後跳轉到 <code>index.html</code>。</p>

    <form id="loginForm" autocomplete="off">
      <label for="pwd">密碼</label>
      <input id="pwd" type="password" placeholder="Enter password" required />
      <div class="row">
        <button type="submit">登入</button>
        <button type="button" class="ghost" id="clearBtn">清除</button>
      </div>
      <div class="err" id="msg"></div>
    </form>
  </div>

  <script>
    /* ============================================================
       設定區（後台只看到亂碼）
       - 正確密碼：NTUB
       - 但這裡只放「亂碼 token」，使用者輸入 NTUB 會被公式運算成對應亂碼來比對
       ============================================================ */
    const SECRET_TOKEN = "AQRNmSdl0g1OVFVCfDdmM2E5YzFksMiWkA";

    const REDIRECT_TO = "./index.html";
    const AUTH_KEY = "site_auth_ok";

    /* ========== Base64URL ========== */
    function b64urlDecodeToBytes(s) {
      const b64 = s.replace(/-/g, "+").replace(/_/g, "/") + "===".slice((s.length + 3) % 4);
      const bin = atob(b64);
      const out = new Uint8Array(bin.length);
      for (let i = 0; i < bin.length; i++) out[i] = bin.charCodeAt(i) & 0xff;
      return out;
    }

    /* ============================================================
       公式：ASCII/byte 運算
       ============================================================ */
    function encodeWithParams(input, params) {
      const { pepperBytes, k1, k2, k3, k4, k5 } = params;
      const out = new Uint8Array(input.length);

      for (let i = 0; i < input.length; i++) {
        const c = input.charCodeAt(i) & 0xff; // ASCII/byte

        let v = (c + k1 + (i * k2)) & 0xff;
        v = (v ^ ((k3 + i * 17) & 0xff)) & 0xff;
        v = ((v * k4) + k5) & 0xff;

        const p = pepperBytes[i % pepperBytes.length] & 0xff;
        v = (v ^ p) & 0xff;

        out[i] = v;
      }
      return out;
    }

    function constantTimeEqualBytes(a, b) {
      if (!(a instanceof Uint8Array) || !(b instanceof Uint8Array)) return false;
      if (a.length !== b.length) return false;
      let diff = 0;
      for (let i = 0; i < a.length; i++) diff |= (a[i] ^ b[i]);
      return diff === 0;
    }

    /* ============================================================
       token 格式（全部藏在一串亂碼裡）
       bytes = [ver, len, k1,k2,k3,k4,k5, pepperLen, pepperBytes..., expectedBytes...]
       ============================================================ */
    function parseSecretToken(token) {
      const bytes = b64urlDecodeToBytes(token);

      let idx = 0;
      const ver = bytes[idx++];
      if (ver !== 1) throw new Error("Unsupported token version");

      const len = bytes[idx++];
      const k1 = bytes[idx++], k2 = bytes[idx++], k3 = bytes[idx++], k4 = bytes[idx++], k5 = bytes[idx++];
      const pepperLen = bytes[idx++];

      const pepperBytes = bytes.slice(idx, idx + pepperLen);
      idx += pepperLen;

      const expected = bytes.slice(idx, idx + len);

      return { len, k1, k2, k3, k4, k5, pepperBytes, expected };
    }

    function verifyPassword(inputPassword) {
      const params = parseSecretToken(SECRET_TOKEN);
      if (typeof inputPassword !== "string") return false;
      if (inputPassword.length !== params.len) return false; // 這裡會要求長度等於 4（NTUB）

      const enc = encodeWithParams(inputPassword, params);
      return constantTimeEqualBytes(enc, params.expected);
    }

    /* ========== UI ========== */
    (function init() {
      const form = document.getElementById("loginForm");
      const pwd = document.getElementById("pwd");
      const msg = document.getElementById("msg");
      const clearBtn = document.getElementById("clearBtn");

      if (sessionStorage.getItem(AUTH_KEY) === "1") {
        location.replace(REDIRECT_TO);
        return;
      }

      clearBtn.addEventListener("click", () => {
        pwd.value = "";
        msg.textContent = "";
        pwd.focus();
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        msg.textContent = "";

        const ok = verifyPassword(pwd.value);

        if (!ok) {
          msg.textContent = "密碼錯誤。";
          pwd.select();
          return;
        }

        sessionStorage.setItem(AUTH_KEY, "1");
        location.replace(REDIRECT_TO);
      });
    })();
  </script>
</body>
</html>";

    const REDIRECT_TO = "./index.html";
    const AUTH_KEY = "site_auth_ok";

    /* ========== Base64URL ========== */
    function b64urlDecodeToBytes(s) {
      const b64 = s.replace(/-/g, "+").replace(/_/g, "/") + "===".slice((s.length + 3) % 4);
      const bin = atob(b64);
      const out = new Uint8Array(bin.length);
      for (let i = 0; i < bin.length; i++) out[i] = bin.charCodeAt(i) & 0xff;
      return out;
    }

    /* ============================================================
       公式：ASCII/byte 運算
       ============================================================ */
    function encodeWithParams(input, params) {
      const { pepperBytes, k1, k2, k3, k4, k5 } = params;
      const out = new Uint8Array(input.length);

      for (let i = 0; i < input.length; i++) {
        const c = input.charCodeAt(i) & 0xff; // ASCII/byte

        let v = (c + k1 + (i * k2)) & 0xff;
        v = (v ^ ((k3 + i * 17) & 0xff)) & 0xff;
        v = ((v * k4) + k5) & 0xff;

        const p = pepperBytes[i % pepperBytes.length] & 0xff;
        v = (v ^ p) & 0xff;

        out[i] = v;
      }
      return out;
    }

    function constantTimeEqualBytes(a, b) {
      if (!(a instanceof Uint8Array) || !(b instanceof Uint8Array)) return false;
      if (a.length !== b.length) return false;
      let diff = 0;
      for (let i = 0; i < a.length; i++) diff |= (a[i] ^ b[i]);
      return diff === 0;
    }

    /* ============================================================
       token 格式（全部藏在一串亂碼裡）
       bytes = [ver, len, k1,k2,k3,k4,k5, pepperLen, pepperBytes..., expectedBytes...]
       ============================================================ */
    function parseSecretToken(token) {
      const bytes = b64urlDecodeToBytes(token);

      let idx = 0;
      const ver = bytes[idx++];
      if (ver !== 1) throw new Error("Unsupported token version");

      const len = bytes[idx++];
      const k1 = bytes[idx++], k2 = bytes[idx++], k3 = bytes[idx++], k4 = bytes[idx++], k5 = bytes[idx++];
      const pepperLen = bytes[idx++];

      const pepperBytes = bytes.slice(idx, idx + pepperLen);
      idx += pepperLen;

      const expected = bytes.slice(idx, idx + len);

      return { len, k1, k2, k3, k4, k5, pepperBytes, expected };
    }

    function verifyPassword(inputPassword) {
      const params = parseSecretToken(SECRET_TOKEN);
      if (typeof inputPassword !== "string") return false;
      if (inputPassword.length !== params.len) return false; // 這裡會要求長度等於 4（NTUB）

      const enc = encodeWithParams(inputPassword, params);
      return constantTimeEqualBytes(enc, params.expected);
    }

    /* ========== UI ========== */
    (function init() {
      const form = document.getElementById("loginForm");
      const pwd = document.getElementById("pwd");
      const msg = document.getElementById("msg");
      const clearBtn = document.getElementById("clearBtn");

      if (sessionStorage.getItem(AUTH_KEY) === "1") {
        location.replace(REDIRECT_TO);
        return;
      }

      clearBtn.addEventListener("click", () => {
        pwd.value = "";
        msg.textContent = "";
        pwd.focus();
      });

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        msg.textContent = "";

        const ok = verifyPassword(pwd.value);

        if (!ok) {
          msg.textContent = "密碼錯誤。";
          pwd.select();
          return;
        }

        sessionStorage.setItem(AUTH_KEY, "1");
        location.replace(REDIRECT_TO);
      });
    })();
  </script>
</body>
</html>